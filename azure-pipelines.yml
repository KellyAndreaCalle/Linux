trigger:
- main

pr: none

strategy:
   matrix:
     linux:
       imageName: "linux-latest"
       nodeVersion: "10.x"
     windows:
       imageName: "windows-latest"
       nodeVersion: "12.x"
     macos:
       imageName: "macos-latest"
       nodeVersion: "12.x"
   maxParallel: 3

jobs:
- job: Work
  pool:
    vmImage: $(imageName)
  steps:
    - task: NodeTool@0
      inputs:
        versionSpec: $(nodeVersion)
      displayName: 'Install Node.js'

    - script: |
        npm install
        npm run build
      displayName: 'npm install and build'

 # This job creates a work item, and only runs if the previous job failed
- job: ErrorHandler
  dependsOn: Work
  condition: failed()
  steps: 
  - bash: |
       az boards work-item create \
         --title "Build $(build.buildNumber) failed" \
         --type bug \
         --org $(System.TeamFoundationCollectionUri) \
         --project $(System.TeamProject)
    env: 
       AZURE_DEVOPS_EXT_PAT: $(System.AccessToken)
    displayName: 'Create work item on failure'